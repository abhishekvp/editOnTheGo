
// The code below uses require.js, a module system for javscript:
// http://requirejs.org/docs/api.html#define

require.config({ 
    baseUrl: 'js/lib',
    paths: {'jquery':
            ['//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min',
             'jquery']},

});

// Include the in-app payments API, and if it fails to load handle it
// gracefully.
// https://developer.mozilla.org/en/Apps/In-app_payments
require(['https://marketplace.cdn.mozilla.net/mozmarket.js'],
        function() {},
        function(err) {
            window.mozmarket = window.mozmarket || {};
            window.mozmarket.buy = function() {
                alert('The in-app purchasing is currently unavailable.');
            };
        });



// When you write javascript in separate files, list them as
// dependencies along with jquery
define("app", function(require) {

    var $ = require('jquery');

    // If using Twitter Bootstrap, you need to require all the
    // components that you use, like so:
    // require('bootstrap/dropdown');
    // require('bootstrap/alert');


    // START HERE: Put your js code here
 var
      gActiveEditor = null, // active editing host
      gCommandDump  = null; // command dump field
    function ExecCommand(toolbarElement) {
      var argVal, argStr,
          type    = toolbarElement.getAttribute("type"),
          command = toolbarElement.getAttribute("data-command");
      switch (type) {    // get the execCommand argument according to the button type
        case "button":   // toolbar button: no argument
          argVal = argStr = false;
          break;
        case "checkbox": // styleWithCSS: boolean argument
          argVal = argStr = toolbarElement.checked;
          break;
        default:         // <select> menu: string argument
          if (!toolbarElement.selectedIndex) return;
          argVal = toolbarElement.value;
          argStr = "'" + argVal.replace("<", "&lt;").replace(">", "&gt;") + "'";
          toolbarElement.selectedIndex = 0; // reset drop-down list
      }
      document.execCommand(command, false, argVal); // send requested action
      if (gActiveEditor) gActiveEditor.focus();     // re-focus the editable element
      gCommandDump.innerHTML = "document.execCommand('" + command + "', false, " + argStr + ");";
    }
    window.addEventListener("DOMContentLoaded", function() {
      var i,
        buttons = document.querySelectorAll("*[data-command]"),
        editors = document.querySelectorAll("*[contenteditable]");
      for (i = 0; i < buttons.length; i++) {
        buttons[i].onclick  = function() { ExecCommand(this); };
        buttons[i].onchange = function() { ExecCommand(this); };
      }
      for (i = 0; i < editors.length; i++)
        editors[i].onfocus = function() { gActiveEditor = this; };
      gCommandDump = document.querySelector("#execCommand");
      ExecCommand(document.querySelector("*[data-command=styleWithCSS]"));
    }, false);




    // Hook up the installation button, feel free to customize how
    // this works
    
    var install = require('install');

    function updateInstallButton() {
        $(function() {
            var btn = $('.install-btn');
            if(install.state == 'uninstalled') {
                btn.show();
            }
            else if(install.state == 'installed' || install.state == 'unsupported') {
                btn.hide();
            }
        });
    }

    $(function() {
        $('.install-btn').click(install);        
    });

    install.on('change', updateInstallButton);

    install.on('error', function(e, err) {
        // Feel free to customize this
        $('.install-error').text(err.toString()).show();
    });

    install.on('showiOSInstall', function() {
        // Feel free to customize this
        var msg = $('.install-ios-msg');
        msg.show();
        
        setTimeout(function() {
            msg.hide();
        }, 8000);
    });

});
